# 8.1 数据查找和传输

B 树和 B+ 树，被广泛用于关系型存储引擎，同时还有 LSM 树（Log-Structured Merged Tree)，它在某种程度上构成了 BigTable 的底层存储架构。

# 8.1.1 B+树

B+ 树能够通过主键对记录进行高效插入、查找和删除。它表示一个动态、多层、有上下界的索引。

B+ 树能够提供高效的范围扫描功能，这得益于它的叶节点相互连接且按主键有序，避免了耗时的遍历树操作。

## 8.1.2 LSM树

LSM 树，输入数据首先被存储在日志文件，这些文件内的数据完全有序。当有日志文件被修改时，对应的更新会被先保存在内存来加速查询。

当系统经历过很多次数据修改，且内存空间被逐渐占满，LSM 树会把有序的键值对写到磁盘中，同时创建一个新的数据存储文件。此时，内存中保存的最近更新就可以丢弃了。

存储文件的组织与 B+ 树类似，不过其为磁盘顺序读取做了优化，所有节点都是满的并按页存储。修改数据文件的操作，通过滚动合并完成。也就是说，系统将现有的页与内存刷写数据混合在一起进行管理，直到数据块达到它的容量。

下图展示了多个块存储归并到磁盘的过程，这是后台线程自动完成的：

![](img/chap8/img0.png)

查询时，先查找内存中的存储，然后再查找磁盘上的文件。

删除是一种特殊的更改，当删除标记被存储后，查找会跳过这些键。当页眉重写时，有删除标记的键会被丢弃。

B 树和 LSM 树的最主要区别在于如何利用硬件，特别是磁盘。

# 8.2 存储

